(function(e){var t,n,r,i;return t={},r=t.Writer={},n=t.Reader={},i=t.messages={error:'<span class="error">Oops! An error occured. Please try <a href="/">refreshing</a> the page.</span>',downloadLink:function(e){return"<a href='"+e+"'>Download Excel file</a>"},wrongFileType:'<span class="error">Sorry! We only accept .xslx files.</span>',readerError:'<span class="error">Hum... There was an error processing that file. Try starting from one generated above?</span>',readerResult:function(e){return e=JSON.stringify(e,void 0,2),"<pre>"+e+"</pre>"}},t.initialize=function(){return this.Writer.initialize(),this.Reader.initialize()},r.busy=!1,r.nRowsDefault=10,r.randMaxDefault=3,r.initialize=function(){return this.model={n_rows:this.nRowsDefault,rand_max:this.randMaxDefault},this.$nRows=e("input[name='n_rows']"),this.$randMax=e("input[name='rand_max']"),this.$submit=e("#js-writer-submit"),this.$message=e("#js-writer-message"),this.$nRows.val(this.nRowsDefault),this.$randMax.val(this.randMaxDefault),this.$submit.click(e.proxy(this.onSubmit,this))},r.onSubmit=function(t){var n,r=this;t!=null&&t.preventDefault();if(this.validateForm())return n=JSON.stringify(this.model),e.ajax({url:"/api/write/demo",type:"POST",contentType:"application/json",data:n,beforeSend:function(){return r.toggleBusy(),r.$message.html("")},success:function(e){return e.error?r.$message.html(i.error):r.$message.html(i.downloadLink(e.file_url))},error:function(){return r.$message.html(i.error)},complete:function(){return r.toggleBusy()}})},r.toggleBusy=function(){return this.busy?(this.$nRows.prop("disabled",!1),this.$randMax.prop("disabled",!1),this.$submit.prop("disabled",!1),this.$submit.text("Generate"),this.busy=!1):(this.$nRows.prop("disabled",!0),this.$randMax.prop("disabled",!0),this.$submit.prop("disabled",!0),this.$submit.text("Loading..."),this.busy=!0),this},r.validateForm=function(){var e;return e=!0,this.validateNRows()||(e=!1),this.validateRandMax()||(e=!1),e},r.validateNRows=function(){var e,t,n;return t=1,e=100,n=this.$nRows.val(),n=parseInt(n*1),isNaN(n)||!isNaN(n)&&(n<=t||n>=e)?(this.$nRows.val(this.nRowsDefault),this.model.n_rows=this.nRowsDefault,!1):(this.$nRows.val(n),this.model.n_rows=n,!0)},r.validateRandMax=function(){var e,t,n;return t=1,e=100,n=this.$randMax.val(),n=parseFloat(n*1),isNaN(n)||!isNaN(n)&&(n<=t||n>=e)?(this.$randMax.val(this.randMaxDefault),this.model.rand_max=this.randMaxDefault,!1):(this.model.rand_max=n,!0)},n.busy=!1,n.initialize=function(){return this.$fileInput=e("input[name='files[]']"),this.$dropZone=e("#filedrop"),this.$message=e("#js-reader-message"),this.initFileUpload()},n.initFileUpload=function(){var t,n=this;return t={url:"/api/read/demo",dataType:"json",dropZone:this.$dropZone,add:function(e,t){return t.files[0].name.match(/\.xlsx$/)?(n.toggleBusy(),n.$message.html(""),t.submit()):n.$message.html(i.wrongFileType)},done:function(e,t){return t.result.error?n.$message.html(i.readerError):n.$message.html(i.readerResult(t.result))},fail:function(){return n.$message.html(i.error)},always:function(){return n.toggleBusy()}},e("#fileupload").fileupload(t),e(document).bind("drop dragover",function(e){return e.preventDefault()}),this.$dropZone.on("dragover",function(e){return n.$dropZone.addClass("hover")}),this.$dropZone.on("dragleave",function(e){return n.$dropZone.removeClass("hover")}),this.$dropZone.on("drop",function(e){return n.$dropZone.removeClass("hover")})},n.toggleBusy=function(){return this.busy?(this.$fileInput.prop("disabled",!1),this.$dropZone.removeClass("disabled"),this.$dropZone.text("Or drop file here"),this.busy=!1):(this.$fileInput.prop("disabled",!0),this.$dropZone.addClass("disabled"),this.$dropZone.text("Loading"),this.busy=!0),this},e(function(){return t.initialize(),window.App=t})})(jQuery);